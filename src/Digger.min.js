window.Digger=window.Digger||function(e,t){function p(t){var r=t||{},i;return this.tag=r.tag||n.tag,i=s[this.tag]||this,s[this.tag]||(s[this.tag]=this,this._tracks={},h.setDefault(this,t||{},n),h.on(e,"beforeunload",function(){for(var e in i._tracks)i.send(e,0);i.log(i.format())})),h.ready(function(){i.initMo(r.tag||n.tag,r.max||n.max,r.type||n.type)}),i}var n={url:"http://localhost/github/digger/log.data",max:1,tag:"mo",type:{click:{},load:{},unload:{}},exdata:{glo:["remarks"],tagname:{A:["href"]}}},r={click:"click",move:"mousemove",enter:"mouseover",leave:"mouseout"},i={},s={},o=!1,u=encodeURIComponent,a=t.referrer,f=e.location,l=e.top.location.href,c=function(){var e=f.search,t=0,n,r=[];if(e){e=e.substring(1).split("&");while(n=e[t++])n.indexOf("_dg_")===0&&r.push(n.replace("_dg_",""))}return r.join("&")}(),h={ie:/msie (\d+\.\d)/i.test(navigator.userAgent),rnd:function(){return Math.floor(Math.random()*2147483648).toString(36)},rand:function(e,t){return Math.floor(e+Math.random()*(t-e+1))},extend:function(e,t){for(var n in t)e[n]=e[n]||t[n]},setDefault:function(e,t,n){for(var r in n)e[r]=e[r]||t[r]||n[r]},delegate:function(e,n,r,i){h.on(e,n,function(e){var n=e.target;if(i)while(n!==this.parentNode&&n!==t.body)n.hasAttribute(i)&&(e.delegateTarget=n,r.call(this,e)),n=n.parentNode;else r.call(this,e)})},on:function(e,t,n){var r=function(t){t=t||window.event,t.delegateTarget=t.srcElement||t.target,t.relTarget=t.relatedTarget||t.toElement||t.fromElement||null,n.call(e,t)};e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},ready:function(e,t){function o(){if(r)return;r=1,e.readyState==="complete"?u():e.addEventListener?(e.addEventListener("DOMContentLoaded",function(){e.removeEventListener("DOMContentLoaded",arguments.callee,!1),u()},!1),t.addEventListener("onload",u,!1)):e.attachEvent&&(e.attachEvent("onreadystatechange",function(){e.readyState==="complete"&&(e.detachEvent("onreadystatechange",arguments.callee),u())}),t.attachEvent("onload",u),s.doScroll&&t==t.top&&a())}function u(){n=1;if(!e.body){setTimeout(u,10);return}for(var t=0,r=i.length;t<r;t++)i[t]();i=[]}function a(){if(n)return;try{s.doScroll("left")}catch(e){setTimeout(a,10);return}u()}var n=0,r=0,i=[],s=e.createElement("p");return function(e){o(e),n?e():i.push(e)}}(t,e),getAttr:function(e,t){return e.getAttribute(t)||""},serialize:function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")},getPos:function(n){function l(e,t){return{x:e-s,y:t-o}}var n=n||e.event,r,i,s,o,u,a;u=Math.max(t.documentElement.scrollTop,t.body.scrollTop),a=Math.max(t.documentElement.scrollLeft,t.body.scrollLeft),h.ie?(r=n.clientX+a,i=n.clientY+u):(r=n.pageX,i=n.pageY);if(this.documentWidth){var f=Math.max(t.documentElement.clientWidth,t.body.clientWidth);s=(f-this.documentWidth)/2,o=0}else s=0,o=0;var c=l(r,i);return r=Math.round(c.x/10)*10,i=Math.round(c.y/10)*10,{x:r,y:i}}};return p.prototype={initMo:function(n,s,o){var u,a=this,f,l,c=+(new Date);for(var p in o)u=o[p]||{},this._tracks[p]=this._tracks[p]||[],r[p]&&!i[n+"|"+p]&&(h.setDefault(u,u,{tag:n,max:s,type:p}),h.delegate(e,r[p],this._getCallbackHandler(u),u.tag),i[n+"|"+p]=1);o.load&&(h.setDefault(o.load,o.load,{tag:n}),f=this.strProp2jsonProp(o.load.msg||h.getAttr(t.body,o.load.tag)),f._ev="load",f._t=+(new Date),this.log(this.format(f))),o.unload&&(h.setDefault(o.unload,o.unload,{tag:n}),l=this.strProp2jsonProp(o.unload.msg||h.getAttr(t.body,o.unload.tag)),h.on(window,"beforeunload",function(){var e=+(new Date);l._dur=e-c,l._ev="unload",l._t=e,a.log(a.format(l))}))},format:h.serialize,getUrl:function(){var e;if(this.url instanceof Array&&(e=this.url.length))return this.url[h.rand(0,e-1)];if("string"==typeof this.url)return this.url;throw new Error("url must string or array, and array must not empty.")},strProp2jsonProp:function(e){var t=0,n={},r;if(!e)return;e=e.split(";");while(r=e[t++])r&&(r=r.split(":"),n[r[0]]=r[1]);return n},getMsg:function(e,t,n,r){var i=0,s,o,a=this,f={_id:t.id||"noid"+ +(new Date),_tagn:t.tagName||"notagname",_x:n.x,_y:n.y,_t:+(new Date),_ev:e};return function(e,t,n){var r=a.strProp2jsonProp(h.getAttr(t,n));for(var i in r)e[i]=u(r[i])}(f,t,r),function(e,t,n){var r=0,i=e.glo||[],s=e.tagname||{},o,a;s[n.tagName.toUpperCase()]&&(i=i.concat(s[n.tagName.toUpperCase()]));while(o=i[r++])(a=h.getAttr(n,o))&&(t[o]=u(a))}(this.exdata||{},f,t),f},log:function(e){var t=new Image(1,1);key=this.tag+"_"+h.rnd(),window[key]=t,t.onload=t.onerror=t.onabort=function(){t.onload=t.onerror=t.onabort=null,window[key]=null,t=null},t.src=this.getUrl()+"?log="+this.tag+"&ref="+u(a)+"&top="+u(l)+(c?"&"+c:"")+"&t="+ +(new Date)+"&msg="+u(e)},send:function(e,t){var n=[],r="",i=this._tracks[e];if(!t){while(r=i.shift())n.push(r);n.length>=0&&this.log(n.join("|"))}else if(i.length>=t){while(t-->0&&(r=i.shift()))n.push(r);n.length>=0&&this.log(n.join("|"))}},_getCallbackHandler:function(e){var t=this,n=e.type,r=e.max,i=e.tag;return function(e){var s=h.getPos(e);t._tracks[n].push(t.format(t.getMsg(n,e.delegateTarget,s,i))),t.send(n,r)}}},p.getObjs=function(e){return s.tag},p}(window,document),new Digger