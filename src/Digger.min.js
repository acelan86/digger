window.Digger=window.Digger||function(e,t,n){function u(e){this._tracks={},this._inited={},this.uid=r.uid(),this.url=e.url,this.max=e.max,this.type=e.type,this.exdata=e.exdata,e.cookie instanceof Array&&this.initCookie(e.cookie),this.init()}var r={E:e.encodeURIComponent,ref:t.referrer,loc:e.location,ifr:e.self!=e.top?1:0,top:function(){var t;try{t=e.top.location.href}catch(n){t=r.ref}return t}(),cookie:{getRaw:function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=t.exec(document.cookie);if(n)return n[2]||null},get:function(e){var t=r.cookie.getRaw(e);return"string"==typeof t?(t=decodeURIComponent(t),t):null}},ie:/msie (\d+\.\d)/i.test(navigator.userAgent),rnd:function(){return Math.floor(Math.random()*2147483648).toString(36)},rand:function(e,t){return Math.floor(e+Math.random()*(t-e+1))},uid:function(){var e=0,t=0,n,i=r.loc.href;for(;!isNaN(n=i.charCodeAt(t++));)e=(e<<5)-e+n,e&=e;return Math.abs(e).toString(36)},forEach:Array.prototype.forEach?function(e,t){e.forEach(t)}:function(e,t){if(!e)return;var n=0,r;while(r=e[n++])t(r,n)},find:function(e,t,n){var i=Array.prototype.slice.call(document.getElementsByTagName(e),0),s=[];return r.forEach(i,function(e,i){(n?r.getAttr(e,t)===n:r.hasAttr(e,t))&&s.push(e)}),s.length>0?s:null},findParent:function(e,n){while(e.parentNode&&e!==t.body&&e.hasAttribute&&!r.hasAttr(e,n))e=e.parentNode;return e},delegate:function(e,n,i,s){r.on(e,n,function(e){var n=e.target;if(s)while(n!==this.parentNode&&n!==t.body)n.hasAttribute(s)&&(e.delegateTarget=n,i.call(this,e)),n=n.parentNode;else i.call(this,e)})},on:function(e,t,n){var r=function(t){t=t||window.event,t.delegateTarget=t.srcElement||t.target,t.relTarget=t.relatedTarget||t.toElement||t.fromElement||null,n.call(e,t)};e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},ready:function(e,t){function o(){if(r)return;r=1,e.readyState==="complete"?u():e.addEventListener?(e.addEventListener("DOMContentLoaded",function(){e.removeEventListener("DOMContentLoaded",arguments.callee,!1),u()},!1),t.addEventListener("onload",u,!1)):e.attachEvent&&(e.attachEvent("onreadystatechange",function(){e.readyState==="complete"&&(e.detachEvent("onreadystatechange",arguments.callee),u())}),t.attachEvent("onload",u),s.doScroll&&t==t.top&&a())}function u(){if(n)return;n=1;if(!e.body){setTimeout(u,10);return}for(var t=0,r=i.length;t<r;t++)i[t]();i=[]}function a(){if(n)return;try{s.doScroll("left")}catch(e){setTimeout(a,10);return}u()}var n=0,r=0,i=[],s=e.createElement("p");return function(e){o(e),n?e():i.push(e)}}(t,e),getAttr:function(e,t){return e.getAttribute?e.getAttribute(t)||"":""},hasAttr:function(e,t){return e.hasAttribute?e.hasAttribute(t):e.getAttribute(t)!==null},serialize:function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")},strProp2jsonProp:function(e){var t=0,n={},r;if(!e)return null;e=e.split(";");while(r=e[t++])r&&(r=r.split(":"),n[r[0]]=r[1]);return n},getPos:function(n){function c(e,t){return{x:e-o,y:t-u}}var n=n||e.event,i,s,o,u,a,f;a=Math.max(t.documentElement.scrollTop,t.body.scrollTop),f=Math.max(t.documentElement.scrollLeft,t.body.scrollLeft),r.ie?(i=n.clientX+f,s=n.clientY+a):(i=n.pageX,s=n.pageY);if(this.documentWidth){var l=Math.max(t.documentElement.clientWidth,t.body.clientWidth);o=(l-this.documentWidth)/2,u=0}else o=0,u=0;var h=c(i,s);return i=Math.round(h.x/10)*10,s=Math.round(h.y/10)*10,{x:i,y:s}}},i={click:"click",move:"mousemove",enter:"mouseover",leave:"mouseout"},s=function(){var e=r.loc.search,t=0,n,i=[];if(e){e=e.substring(1).split("&");while(n=e[t++])n.indexOf("_dg_")===0&&i.push(n.replace("_dg_",""))}return i.join("&")}(),o;return u.prototype={init:function(){var n=this,s=+(new Date),o=this.type,u=this.max,a=this.tag;for(var f in o)type=o[f]||{},this._tracks[f]=this._tracks[f]||[],i[f]&&(type.tag=type.tag||a,type.max=type.max||u,type.type=type.type||f,r.delegate(t.body,i[f],this._getCallbackHandler(type),type.tag));r.on(e,"beforeunload",function(){for(var e in n._tracks)n.send(e,0);if(o.unload)for(var t in n._inited){var r=+(new Date);n.log(n.format({_dur:r-s,_ev:"unload",_t:r,_bid:t}))}})},initCookie:function(e){var t=[];r.forEach(e,function(e,n){var i=r.cookie.get(e);i&&t.push(e+"="+i)}),this._ck=t.join(";")},register:function(e){var t=this,n=this.type,e=e||this.uid;n.load&&(this._inited[e]||this.log(this.format({_et:"load",_t:+(new Date),_bid:e}))),this._inited[e]=1},format:r.serialize,getUrl:function(){var e;if(this.url instanceof Array&&(e=this.url.length))return this.url[r.rand(0,e-1)];if("string"==typeof this.url)return this.url;throw new Error("url must string or array, and array must not empty.")},getMsg:function(e,t,n,i,s){var o=0,u,a,f=this,l={_id:t.id||"noid"+r.rnd(),_tagn:t.tagName||"notagname",_x:n.x,_y:n.y,_t:+(new Date),_ev:e,_bid:s||this.uid};return function(e,t,n){var i=r.strProp2jsonProp(r.getAttr(t,n));for(var s in i)e[s]=r.E(i[s])}(l,t,i),function(e,t,n){var i=0,s=e.glo||[],o=e.tagname||{},u,a;o[n.tagName.toUpperCase()]&&(s=s.concat(o[n.tagName.toUpperCase()]));while(u=s[i++])(a=r.getAttr(n,u))&&(t[u]=r.E(a))}(this.exdata||{},l,t),l},log:function(e){var t=new Image(1,1),n=this.uid+"_"+r.rnd(),i,o=this.getUrl();window[n]=t,t.onload=t.onerror=t.onabort=function(){t.onload=t.onerror=t.onabort=null,window[n]=null,t=null},t.src=o+"?log="+this.uid+"&ifr="+r.ifr+"&ref="+r.E(r.ref)+"&top="+r.E(r.top)+(s?"&"+s:"")+"&t="+ +(new Date)+(this._ck?"&ck="+r.E(this._ck):"")+"&msg="+r.E(e)},send:function(e,t){var n=[],r="",i=this._tracks[e];if(!t){while(r=i.shift())n.push(r);n.length>0&&this.log(n.join("|"))}else if(i.length>=t){while(t-->0&&(r=i.shift()))n.push(r);n.length>0&&this.log(n.join("|"))}},_getCallbackHandler:function(e){var t=this,n=e.type,i=e.max,s=e.tag;return function(e){var o=r.findParent(e.delegateTarget,"digger");o=r.getAttr(o,"digger");var u=r.getPos(e);t._tracks[n].push(t.format(t.getMsg(n,e.delegateTarget,u,s,o))),t.send(n,i)}}},function(){r.ready(function(){r.forEach(r.find("script","digger"),function(e,t){!o&&(o=new u(n)),o.register(r.getAttr(e,"digger"))})})}}(window,document,{url:["http://localhost/github/digger/log1.data","http://localhost/github/digger/log2.data","http://localhost/github/digger/log3.data"],max:1,tag:"mo",type:{click:{tag:"clk"},enter:{tag:"enter",max:10},leave:{tag:"leave",max:30},load:{},unload:{}},cookie:["CoupletMedia903999100"],exdata:{glo:["remarks"],tagname:{A:["href"]}}}),window.Digger()