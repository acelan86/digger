window.Digger=window.Digger||function(e,t){function u(e){this._tracks={},this._inited={},this.uid=n.uid(),this.url=e.url,this.max=e.max,this.type=e.type,this.exdata=e.exdata,this.init()}var n={E:encodeURIComponent,ref:t.referrer,loc:e.location,top:function(){var t;try{t=e.top.location.href}catch(r){t=n.ref}return t}(),ie:/msie (\d+\.\d)/i.test(navigator.userAgent),rnd:function(){return Math.floor(Math.random()*2147483648).toString(36)},rand:function(e,t){return Math.floor(e+Math.random()*(t-e+1))},uid:function(){var e=0,t=0,r,i=n.loc.href;for(;!isNaN(r=i.charCodeAt(t++));)e=(e<<5)-e+r,e&=e;return Math.abs(e).toString(36)},forEach:Array.prototype.forEach?function(e,t){e.forEach(t)}:function(e,t){var n=0,r;while(r=e[n++])t(r,n)},find:function(e,t,r){var i=Array.prototype.slice.call(document.getElementsByTagName(e),0),s=[];return n.forEach(i,function(e,i){(r?n.getAttr(e,t)===r:n.hasAttr(e,t))&&s.push(e)}),s.length>0?s:null},findParent:function(e,r){while(e.parentNode&&e!==t.body&&e.hasAttribute&&!n.hasAttr(e,r))e=e.parentNode;return e},delegate:function(e,r,i,s){n.on(e,r,function(e){var n=e.target;if(s)while(n!==this.parentNode&&n!==t.body)n.hasAttribute(s)&&(e.delegateTarget=n,i.call(this,e)),n=n.parentNode;else i.call(this,e)})},on:function(e,t,n){var r=function(t){t=t||window.event,t.delegateTarget=t.srcElement||t.target,t.relTarget=t.relatedTarget||t.toElement||t.fromElement||null,n.call(e,t)};e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},ready:function(e,t){function o(){if(r)return;r=1,e.readyState==="complete"?u():e.addEventListener?(e.addEventListener("DOMContentLoaded",function(){e.removeEventListener("DOMContentLoaded",arguments.callee,!1),u()},!1),t.addEventListener("onload",u,!1)):e.attachEvent&&(e.attachEvent("onreadystatechange",function(){e.readyState==="complete"&&(e.detachEvent("onreadystatechange",arguments.callee),u())}),t.attachEvent("onload",u),s.doScroll&&t==t.top&&a())}function u(){n=1;if(!e.body){setTimeout(u,10);return}for(var t=0,r=i.length;t<r;t++)i[t]();i=[]}function a(){if(n)return;try{s.doScroll("left")}catch(e){setTimeout(a,10);return}u()}var n=0,r=0,i=[],s=e.createElement("p");return function(e){o(e),n?e():i.push(e)}}(t,e),getAttr:function(e,t){return e.getAttribute?e.getAttribute(t)||"":""},hasAttr:function(e,t){return e.hasAttribute?e.hasAttribute(t):!1},serialize:function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")},strProp2jsonProp:function(e){var t=0,n={},r;if(!e)return null;e=e.split(";");while(r=e[t++])r&&(r=r.split(":"),n[r[0]]=r[1]);return n},getPos:function(r){function c(e,t){return{x:e-o,y:t-u}}var r=r||e.event,i,s,o,u,a,f;a=Math.max(t.documentElement.scrollTop,t.body.scrollTop),f=Math.max(t.documentElement.scrollLeft,t.body.scrollLeft),n.ie?(i=r.clientX+f,s=r.clientY+a):(i=r.pageX,s=r.pageY);if(this.documentWidth){var l=Math.max(t.documentElement.clientWidth,t.body.clientWidth);o=(l-this.documentWidth)/2,u=0}else o=0,u=0;var h=c(i,s);return i=Math.round(h.x/10)*10,s=Math.round(h.y/10)*10,{x:i,y:s}}},r={url:["http://localhost/github/digger/log1.data","http://localhost/github/digger/log2.data","http://localhost/github/digger/log3.data"],max:1,tag:"mo",type:{click:{tag:"clk"},enter:{tag:"enter",max:10},leave:{tag:"leave",max:30},load:{},unload:{}},exdata:{glo:["remarks"],tagname:{A:["href"]}}},i={click:"click",move:"mousemove",enter:"mouseover",leave:"mouseout"},s=function(){var e=n.loc.search,t=0,r,i=[];if(e){e=e.substring(1).split("&");while(r=e[t++])r.indexOf("_dg_")===0&&i.push(r.replace("_dg_",""))}return i.join("&")}(),o;return u.prototype={init:function(){var r=this,s=+(new Date),o=this.type,u=this.max,a=this.tag;for(var f in o)type=o[f]||{},this._tracks[f]=this._tracks[f]||[],i[f]&&(type.tag=type.tag||a,type.max=type.max||u,type.type=type.type||f,n.delegate(t.body,i[f],this._getCallbackHandler(type),type.tag));n.on(e,"beforeunload",function(){for(var e in r._tracks)r.send(e,0);if(o.unload)for(var t in r._inited){var n=+(new Date);r.log(r.format({_dur:n-s,_ev:"unload",_t:n,_bid:t}))}})},register:function(e){var t=this,n=this.type,e=e||this.uid;n.load&&(this._inited[e]||this.log(this.format({_et:"load",_t:+(new Date),_bid:e}))),this._inited[e]=1},format:n.serialize,getUrl:function(){var e;if(this.url instanceof Array&&(e=this.url.length))return this.url[n.rand(0,e-1)];if("string"==typeof this.url)return this.url;throw new Error("url must string or array, and array must not empty.")},getMsg:function(e,t,r,i,s){var o=0,u,a,f=this,l={_id:t.id||"noid"+n.rnd(),_tagn:t.tagName||"notagname",_x:r.x,_y:r.y,_t:+(new Date),_ev:e,_bid:s||this.uid};return function(e,t,r){var i=n.strProp2jsonProp(n.getAttr(t,r));for(var s in i)e[s]=n.E(i[s])}(l,t,i),function(e,t,r){var i=0,s=e.glo||[],o=e.tagname||{},u,a;o[r.tagName.toUpperCase()]&&(s=s.concat(o[r.tagName.toUpperCase()]));while(u=s[i++])(a=n.getAttr(r,u))&&(t[u]=n.E(a))}(this.exdata||{},l,t),l},log:function(e){var t=new Image(1,1),r=this.uid+"_"+n.rnd(),i,o=this.getUrl();window[r]=t,t.onload=t.onerror=t.onabort=function(){t.onload=t.onerror=t.onabort=null,window[r]=null,t=null},t.src=o+"?log="+this.uid+(i?"&"+i:"")+"&ref="+n.E(n.ref)+"&top="+n.E(top)+(s?"&"+s:"")+"&t="+ +(new Date)+"&msg="+n.E(e)},send:function(e,t){var n=[],r="",i=this._tracks[e];if(!t){while(r=i.shift())n.push(r);n.length>0&&this.log(n.join("|"))}else if(i.length>=t){while(t-->0&&(r=i.shift()))n.push(r);n.length>0&&this.log(n.join("|"))}},_getCallbackHandler:function(e){var t=this,r=e.type,i=e.max,s=e.tag;return function(e){var o=n.findParent(e.delegateTarget,"digger");o=n.getAttr(o,"digger");var u=n.getPos(e);t._tracks[r].push(t.format(t.getMsg(r,e.delegateTarget,u,s,o))),t.send(r,i)}}},function(){n.ready(function(){n.forEach(n.find("script","digger"),function(e,t){!o&&(o=new u(r)),o.register(n.getAttr(e,"digger"))})})}}(window,document),window.Digger()